<?xml version="1.0"?>

<!-- MDT XML version 20140522 -->

<!-- GFDL Model Development Team (MDT) documentation: http://cobweb.gfdl.noaa.gov/~niz/mdt/ -->
<!-- GFDL MDT Atmosphere Working Group (AWG) documentation: http://cobweb.gfdl.noaa.gov/~cjg/awg/ -->

<!-- QUICK START GUIDE:

# Change YOURGROUPLETTER to your group, such as f, w, o...
      <project>gfdl_YOURGROUPLETTER</project>

# To check out codes and compile:
# for target option "-t openmp", the default is prod-openmp
module load fre/bronx-7
fremake -x CM4_proto.xml -p ncrc2.intel -t openmp cm4p1_compile

# To run regression test (for the coupled experiment CM4_c192L48_am4a1_2000, year 2000 forcing): 
frerun -r basic -x CM4_proto.xml -p ncrc2.intel -t openmp CM4_c192L48_am4a1_2000

# To run a complete coupled experiment (with automated database entry if MDBIswitch in "on"):
frerun -x CM4_proto.xml -p ncrc2.intel -t openmp CM4_c192L48_am4a1_2000

# To run fredb after an experiment is finished to manually add it to the database:
fredb -x CM4_proto.xml -p gfdl.ncrc2-intel -t openmp -n CM4_c192L48_am4a1_2000

# To check what is the input data of this experiment:
inputfiles -x CM4_proto.xml -p ncrc2.intel
-->

<experimentSuite rtsVersion="4" xmlns:xi="http://www.w3.org/2003/XInclude">

  <property name="RELEASE" value="tikal_201403"/>                <!-- CVS tag for source code -->
  <property name="MOM6_GIT_TAG" value="dev/master/2014.05.14"/>  <!-- git tag for MOM6 source code -->
  <property name="FRE_STEM" value="mdt/$(RELEASE)"/>             <!-- customize as needed -->
<!--  <property name="FRE_STEM" value="$(RELEASE)_awgUpdates_mom6_2014.05.14"/> -->
  <property name="FRE_VERSION" value="bronx-7"/>
  <property name="ANALYSIS_SWITCH" value="on"/>
  <property name="MDBIswitch" value="on"/>                       <!-- on/off switch for MDBI database -->
  <property name="ProjectID" value="MDT"/>                       <!-- database top level -->
<!--
Model configurations in support of MDT Atmosphere Working Group (AWG).
Based on v20140401 revision, but with modifications for new topo_drag
formulation from Steve Garner.

GFDL FAIR USE POLICY

GFDL recognizes the essential nature of collaboration in the scientific
enterprise, including the importance of novel application and analysis of our
models. In order to maximize mutual benefit from collaboration, the use of
experimental GFDL models** should be done in a manner that ensures that
individuals involved in model development receive proper credit for their
work; in order to minimize the potential for misapplication of experimental
models, collaborations should actively engage model developers. Publication of
results using experimental GFDL models should be done in consultation with
scientists that participated in the model development. Consultation with GFDL
model developers should occur before submission of publications based on
experimental GFDL models, and should include agreement on the appropriate level
of acknowledgment, co-authorship and participation by the model developers.
Since experimental models have not been thoroughly vetted, experimental GFDL
models and their output should be distributed only after consultation with the
developers of the model. After a GFDL model has been described in a
peer-reviewed publication it is no longer experimental, and results based on
the model should cite the publication(s) describing the model.
 
** "Experimental GFDL models" refers to models (e.g., a coupled climate model),
model components (e.g., parameterization schemes), model configurations (e.g.,
the specific arrangement and parameter settings of model components) arising
from model development efforts at GFDL, but whose formulation and configuration
have not yet been documented in the peer-reviewed literature, as well as outputs
from integrations with these models.
-->

<!--====================-->
<!--= AMIP EXPERIMENTS =-->
<!--====================-->

<!--
AMIP simulations are configured to start in 1980 with the first year being a 
spin-up year. Postprocessing and analysis are performed starting in 1981. The 
length of the simulation and analysis period can be controlled by changing 
properties below.
-->

  <!-- make sure to change current_date in coupler_nml accordingly -->
  <property name="EXP_AMIP_START" value="1980"/>
  <property name="EXP_AMIP_END" value="2000"/>
  <property name="EXP_AMIP_LEN" value="21"/>
  <property name="ANA_AMIP_START" value="1981"/>
  <property name="ANA_AMIP_END" value="2000"/>
  <property name="ANA_AMIP_LEN" value="20yr"/>
  <!-- Post-processing chunk length -->
  <!-- ANA_AMIP_LEN must be an integer multiple of PP_AMIP_CHUNK -->
  <property name="PP_AMIP_CHUNK" value="5yr"/>

<!--=====================================-->
<!--= RFP, CESS SENSITIVITY EXPERIMENTS =-->
<!--=====================================-->

<!--
Experiments to compute RFP (Radiative Flux Perturbation) and Cess sensitivity 
were originally configured by Larry Horowitz. Experiments are configured to 
start in year 0001, postprocessing and analysis are performed starting from 
the second year (0002). The length of the simulation and analysis period can 
be controlled by changing properties below.
-->

  <!-- make sure to change current_date in coupler_nml accordingly -->
  <property name="EXP_CLIMO_START" value="0001"/>
  <property name="EXP_CLIMO_END" value="0011"/>
  <property name="EXP_CLIMO_LEN" value="11"/>
  <property name="ANA_CLIMO_START" value="0002"/>
  <property name="ANA_CLIMO_END" value="0011"/>
  <property name="ANA_CLIMO_LEN" value="10yr"/>
  <property name="PP_CLIMO_CHUNK" value="5yr"/>

<!--====================-->
<!--= CMIP EXPERIMENTS =-->
<!--====================-->

<!--
CMIP simulations are configured to start in year 0001 as well as postprocessing and 
analysis. The length of the simulation and analysis period can be controlled by changing 
properties below.
-->

  <!-- make sure to change current_date in coupler_nml accordingly -->
  <property name="EXP_CMIP_START" value="0001"/>
  <property name="EXP_CMIP_END" value="0030"/>
  <property name="EXP_CMIP_LEN" value="30"/>
  <property name="ANA_CMIP_START" value="0001"/>
  <property name="ANA_CMIP_END" value="0030"/>
  <property name="ANA_CMIP_LEN" value="30yr"/>
  <property name="PP_CMIP_CHUNK" value="5yr"/>
  <property name="PP_OCEAN_CHUNK" value="5yr"/> 


<!--=========================================-->
<!--= Properties needed for OM4 EXPERIMENTS =-->
<!--=========================================-->
   <property name="PROD_SIMTIME_OM4"   value="5"/>
   <property name="PROD_RUNTIME_OM4"   value="16:00:00"/>
   <property name="PROD_SEGTIME_OM4"   value="03:15:00"/>
   <property name="reference_tag"      value="tikal_201403_awgUpdates_mom6_2014.05.14"/> 
<!-- Reference release tag for existing files in the archives for answer comparison. Used in "REFERENCE" property. -->


<!--=================-->
<!--= CHANGING NPES =-->
<!--=================-->

<!--
This xml includes a number of predefined options for the number of PEs.
Layouts, physics windows, threads for each set of PEs were optimized by 
Rusty Benson. Changing the number of PEs can be accomplished by simply 
modifying 'npes' and segment 'runTime' in the xml <production> block:

      <production simTime="$(EXP_AMIP_LEN)" units="years" npes="1728" runTime="16:00:00">
        <segment simTime="12" units="months" runTime="3:00:00"/>
      </production>

Choosing a particular PE number is a balancing act. The higher npes, 
the faster the model throughput, but also the lower the model efficiency
(i.e. the overall simulation will cost more in terms of core hours).

Available options for atmos only c192L48:

  +========+======================+======================+
  |npes    |  Suggested run time for 12 month segment    |
  |        |    am4a1             |    am4b1             |
  +========+======================+======================+
  |  1152  |    16:00:00 (?)      |    16:00:00 (?)      |
  |  2304  |    09:00:00          |    09:00:00          |
  |  3456  |    07:00:00          |    07:00:00          |
  | *4608* |    05:20:00          |    06:00:00          |
  |  6912  |    04:00:00          |    05:00:00          |
  +========+======================+======================+

Available options for coupled c192L48:

  +========+======================+======================+
  |npes    |  Suggested run time for 12 month segment    |
  |        |    CM4_am4a1         |    CM4_am4b1         |
  +========+======================+======================+
  |  1152  |    ????????          |    ????????          |
  |  1728  |    ????????          |    ????????          |
  |  3210  |    ????????          |    ????????          |
  |  3456  |    ????????          |    ????????          |
  |  6912  |    ????????          |    ????????          |
  | *7040* |    12:00:00          |    12:00:00          |
  +========+======================+======================+

Note: default settings are *highlighted*. Suggested 
run time values may need to be adjusted for your specific
configuration.
-->

  <setup>

<!-- MDBI -->
    <fmsRelease>fmsversion</fmsRelease>
<!-- /MDBI -->

    <platform name="ncrc2.intel">
<!-- Please make sure to change "YOURGROUPLETTER" to your group, such as b, f, g, m, o... -->
      <project>gfdl_YOURGROUPLETTER</project>
      <directory stem="$(FRE_STEM)">
        <!--unswept locations--><!-- CPERM=/lustre/f1/unswept -->
	<root>$HOME/$(stem)</root>
	<exec>$CPERM/$USER/$(stem)/$(name)/$(platform)-$(target)/exec</exec>
	<state>$CPERM/$USER/$(stem)/$(name)/$(platform)-$(target)/state</state>
 	<scripts>$CPERM/$USER/$(stem)/$(name)/$(platform)-$(target)/scripts</scripts>
        <!--swept locations (including the staged archive location)-->
        <archive>$CTMP/$USER/$(stem)/$(name)/$(platform)-$(target)/archive</archive>
        <stdout>$CTMP/$USER/$(stem)/$(name)/$(platform)-$(target)/stdout</stdout>
        <work>$CTMP/$USER/work/$(stem)/$FRE_JOBID</work>
      </directory>
      <property name="F2003_FLAGS"       value=" -DINTERNAL_FILE_NML -g -traceback"/>
      <property name="AWG_INPUT_HOME"    value="/ncrc/home2/Chris.Golaz/awg/tikal_201403/input"/>
      <property name="AWG_ARCHIVE_ROOT"  value="/lustre/f1/unswept/Chris.Golaz/archive/mdt"/>
      <property name="NB_ROOT"           value="/nbhome/$USER/$(FRE_STEM)/$(name)"/>
      <property name="REFERENCE"         value="/lustre/f1/unswept/Niki.Zadeh/$(reference_tag)/$(name)/$(platform)-$(target)"/>
      <csh><![CDATA[
        source $MODULESHOME/init/csh
 
        module use -a /ncrc/home2/fms/local/modulefiles
        module unload PrgEnv-pgi PrgEnv-pathscale PrgEnv-intel PrgEnv-gnu PrgEnv-cray
        module unload netcdf fre
        module load PrgEnv-intel/4.0.46
        module swap intel intel/12.0.5.220
        module load fre/$(FRE_VERSION)
 
        setenv KMP_STACKSIZE 512m
        setenv NC_BLKSZ 1M
        setenv F_UFMTENDIAN big
      ]]></csh>
    </platform>

    <platform name="ncrc2.default">
      <xi:include xpointer="xpointer(//setup/platform[@name='ncrc2.intel']/node())" />
    </platform>

    <platform name="gfdl.ncrc2-intel">
      <directory stem="$(FRE_STEM)">
<!-- MDBI requires these to be listed in order to show the path under "Platform Environment" -->
        <archive>$ARCHIVE/$(stem)/$(name)/$(platform)-$(target)</archive>
        <analysis>/nbhome/$USER/$(stem)/$(name)</analysis>
	<ptmp>/ptmp/$USER</ptmp>
<!-- /MDBI -->
      </directory>
      <property name="F2003_FLAGS"       value=" -DINTERNAL_FILE_NML"/>
      <property name="AWG_INPUT_HOME"    value="/home/cjg/awg/tikal_201403/input"/>
      <property name="AWG_ARCHIVE_ROOT"  value="/archive/cjg/mdt"/>
      <property name="NB_ROOT"           value="/nbhome/$USER/$(FRE_STEM)/$(name)"/>
      <property name="REFERENCE"         value=""/>
      <csh><![CDATA[
        source $MODULESHOME/init/csh
        module use -a /home/fms/local/modulefiles
        module purge
        module load fre/$(FRE_VERSION)
        module load fre-analysis
#git MOM6 analysis scripts
           setenv FREVERSION fre/$(FRE_VERSION)           
           setenv NBROOT $(NB_ROOT)
           mkdir -p $NBROOT
           cd $NBROOT
/home/Niki.Zadeh/bin/git_clone_mom6_fix.csh 
        ]]>
      </csh>
    </platform>

    <platform name="gfdl.ncrc2-default">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.ncrc2-intel']/node())" />
    </platform>
    <platform name="gfdl.default">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.ncrc2-intel']/node())" />
    </platform>


  </setup>

<!--===========-->
<!--= COMPILE =-->
<!--===========-->
  <!--The property MOM6_SRC should point to the mom6 src code that is checked out. It is needed by MOM6 to access its inpu data files-->
  <property name="MOM6_SRC"  value="$root/cm4p1_compile/src/mom6"/>  <!-- cm4p1_compile is the compile experiment name -->

  <experiment name="cm4p1_compile">
    <description>

Experiment to build executable.
* tikal_201403 code base
* MOM6 ocean code (updated to dev/master/2014.04.03)
* code updates from Rick Hemler to allow use of ncar v1.5 microphysics (tikal_ncar1p5_micro_rsh)
* code updates from Rick Hemler for update water path diagnostics (tikal_precip_paths_rsh)
* bug fixes from Will Cooke (vert_turbdiff_gnu_conv_wfc, tikal_ncar1p5_micro_rsh_wfc)
* code updates from Xianglei Huang to increase olr band diagnostics (tikal_rad_diag_xlh_cjg)
* code updates from Chris Golaz for new PBL depth diagnostics (tikal_pbl_depth_cjg)
* bug fix from Ming Zhao regarding entrainment rate (dpconv20140318_miz)
* updated topo_drag from Steve Garner (tikal_topo_drag_garner_cjg)
* bug fix from Zhi (tikal_bugfix_z1l)
* bug fix from Huan Guo for CLUBB and MG microphysics (clubb20140516_h1g_MG1p5Interface clubb20140414_h1g_simpleInterface clubb20140516_h1g_MGbug_fix)
 
    </description>

    <component name="fms" paths="shared">
     <description domainName="infrastructure" communityName="FMS" communityVersion="$(RELEASE)" communityGrid=""/>
      <source>
        <codeBase version="$(RELEASE)"> shared </codeBase>
        <!--The following update is needed to run in debug mode with Intel-->
        <csh>cvs up -r tikal_bugfix_z1l shared/mpp/include/mpp_update_domains2D.h </csh>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) -Duse_libMPI -Duse_netCDF </cppDefs>
      </compile>
    </component>

    <component name="atmos_phys" requires="fms" paths="atmos_param atmos_shared">
      <description domainName="" communityName="" communityVersion="$(RELEASE)" communityGrid=""/>
      <source>
        <codeBase version="$(RELEASE)"> atmos_shared atmos_param_am3 </codeBase>
        <csh>
           cvs update -r tikal_ncar1p5_micro_rsh atmos_param/strat_cloud/aerosol_cloud.F90 atmos_param/strat_cloud/cldwat2m_micro.F90 atmos_param/strat_cloud/microphysics.F90 atmos_param/strat_cloud/morrison_gettelman_microp.F90 atmos_param/strat_cloud/rotstayn_klein_mp.F90 atmos_param/strat_cloud/strat_cloud.F90 atmos_param/strat_cloud/strat_cloud_utilities.F90 atmos_param/strat_cloud/strat_nml.h atmos_param/strat_cloud/micro_mg.F90
           cvs update -r tikal_precip_paths_rsh atmos_param/moist_processes/moist_processes.F90
           cvs update -r tikal_ncar1p5_micro_rsh_wfc atmos_param/strat_cloud/rotstayn_klein_mp.F90
           cvs update -r tikal_rad_diag_xlh_cjg atmos_param/sea_esf_rad/longwave_driver.F90 atmos_param/sea_esf_rad/rad_output_file.F90 atmos_param/sea_esf_rad/sealw99.F90
           cvs update -r tikal_pbl_depth_cjg atmos_param/physics_driver/physics_driver.F90 atmos_param/vert_turb_driver/vert_turb_driver.F90
           cvs update -r dpconv20140318_miz atmos_param/shallow_cu/conv_plumes_k.F90 atmos_param/shallow_cu/conv_plumes_k.F90
           cvs update -r tikal_topo_drag_garner_cjg atmos_param/damping_driver/damping_driver.F90 atmos_param/topo_drag/topo_drag.F90
           cvs update -r clubb20140516_h1g_MG1p5Interface atmos_param/clubb/MG_microp_3D.F90
           cvs update -r clubb20140414_h1g_simpleInterface   atmos_param/physics_driver/physics_driver.F90  atmos_param/moist_processes/moist_processes.F90
           cvs update -r clubb20140516_h1g_MGbug_fix  atmos_param/strat_cloud/cldwat2m_micro.F90  atmos_param/strat_cloud/micro_mg.F90
         </csh>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) -DCLUBB</cppDefs>
      </compile>
    </component>

    <component name="atmos_dyn" requires="fms atmos_phys" paths="atmos_coupled atmos_cubed_sphere">
      <description domainName="CubedSphere" communityName="CubedSphere" communityVersion="$(RELEASE)" communityGrid=""/>
      <source>
        <codeBase version="$(RELEASE)">
          atmos_coupled cubed_sphere_coupled
        </codeBase>
        <csh>
          cvs update -r tikal_pbl_depth_cjg atmos_coupled/atmos_model.F90 
          cvs update -r tikal_pbl_depth_cjg atmos_cubed_sphere/driver/coupled/atmosphere.F90 atmos_cubed_sphere/driver/coupled/fv_physics.F90
        </csh>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) -DSPMD -DUSE_OCEAN_BGC -DOLD_PT_TO_T -DOLD_COS_SG</cppDefs>
      </compile>
    </component>

    <component name="ice_sis" requires="fms" paths="ice_sis ice_param">
      <description domainName="Sea Ice SIS" communityName="GFDL-SIS" communityVersion="$(RELEASE)" communityGrid="Tripolar"/>
      <source>
        <codeBase version="$(RELEASE)"> ice_sis ice_param </codeBase>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) -Duse_netCDF</cppDefs>
      </compile>
    </component>

    <component name="land_lad2" requires="fms" paths="land_lad2">
      <description domainName="LM3" communityName="land_lad2" communityVersion="$(RELEASE)" communityGrid=""/>
      <source>
        <codeBase version="$(RELEASE)"> land_lad2 </codeBase>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) -DUSE_LOG_DIAG_FIELD_INFO</cppDefs>

<!--The following csh block is needed for compiler pre-processors that are not ANSI-compliant, such as pathscale-->
<csh> <![CDATA[
cat >Makefile.cpp <<EOF
CPPDEFS =
FRETARGET = $(target)
ifneq (\$(findstring hdf5,\${FRETARGET}),)
else
  CPPDEFS += -Duse_LARGEFILE
endif
EOF
echo vpath %.F90 `find $cwd/land_lad2 -type d` >> Makefile.cpp
echo cpp_land/%.f90: %.F90 >> Makefile.cpp
/bin/echo -e '\tcpp ${CPPDEFS} -C -v -I shared/include -o $@ $<' >> Makefile.cpp
mkdir -p cpp_land
foreach foo ( `find land_lad2 -type f -name \*.F90` )
  make -f Makefile.cpp cpp_land/$foo:t:r.f90
end
find cpp_land -type f -name \*.f90 > pathnames_land_lad2
        ]]></csh>

      </compile>
    </component>

    <component name="mom6" requires="fms" paths="mom6/config_src/dynamic mom6/config_src/coupled_driver mom6/src/*/ mom6/src/*/*/">
      <description domainName="Ocean" communityName="GFDL-MOM6" communityVersion="$(MOM6_GIT_TAG)" communityGrid="Tripolar"/>
      <source versionControl="git" root="http://gitlab.gfdl.noaa.gov/github_mirror">
        <codeBase version="$(MOM6_GIT_TAG)"> noaa-gfdl-mom6.git </codeBase>
        <csh> mv noaa-gfdl-mom6 mom6 </csh>
      </source>
      <compile>
        <cppDefs><![CDATA[ $(F2003_FLAGS) -D_FILE_VERSION="'"`git-version-string $<`"'" ]]></cppDefs>
        <makeOverrides>OPENMP=""</makeOverrides> <!-- openmp switch for MOM6 may cause crash -->
      </compile>
    </component>

<!--
    <component paths="ocean_shared" requires="fms" name="ocean_shared">
      <description domainName="Ocean Generic Tracers" communityName="GFDL-ocean-shared" communityVersion="$(RELEASE)" communityGrid="Tripolar"/>
      <source>
        <codeBase version="$(RELEASE)"> ocean_shared </codeBase>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) </cppDefs>
      </compile>
    </component>
-->

    <component name="coupler" paths="coupler" requires="fms atmos_dyn atmos_phys land_lad2 ice_sis mom6">
      <description domainName="FMS Coupler" communityName="coupler" communityVersion="$(RELEASE)" communityGrid=""/>  
      <source versionControl="git" root="http://gitlab.gfdl.noaa.gov/fms">
        <codeBase version="$(RELEASE)"> coupler.git </codeBase>
          <csh>
            cd coupler; git checkout user/nnz/merge_tikal_pbl_depth_cjg 
          </csh>
      </source>
      <compile>
        <cppDefs><![CDATA[$(F2003_FLAGS) -D_FILE_VERSION="'"`git-version-string $<`"'"]]></cppDefs>
      </compile>
    </component>

  </experiment>

<!--============================-->
<!--= TEMPLATES FOR INPUT DATA =-->
<!--============================-->

  <experiment name="common_data">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/common/sea_esf_aug2013.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/lm3/lm3_data_20130815.tar</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/aerosol_inputs.dec2009.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/RCP/cmip5_rcp45.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/tropchem_oct2011.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/megan2.1_input.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/historical/emissions.1x1.1859_2020.tar</dataSource>
      </dataFile>
      <dataFile label="fieldTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/field_table/field_table_am4p1_v20140324</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/aerosol/gas_conc_3D48L_am3p9.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/anthro_so2.1859_2010.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/emissions/emissions.simple.so2.1x1.1859_2020.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/emis_fuel_aircraft.1859_2010.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/emissions/emissions.aircraft.aero.1x1.1859_2020.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/emissions/so2_0.25_volcanoes.nc</dataSource>
      </dataFile>

      <diagTable>
$name
$baseDate

      </diagTable>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_atmos_v20140325</dataSource>
      </dataFile>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_land_v20140325</dataSource>
      </dataFile>
    </input>
  </experiment>


  <experiment name="amip_data">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/sst/hadisst.186912-201401.tar</dataSource>
      </dataFile>
      <dataFile label="dataTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/data_table/data_table_amip_v20140324</dataSource>
      </dataFile>
      <dataFile label="dataTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/data_table/data_table_co2_v20140324</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="cmip_data"><!--Niki: This is not used in this xml--><!--Ni: I'd prefer to remove this if it's not needed-->
    <input>
      <dataFile label="input" target="INPUT/hadisst_sst.data.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/sst.climo.1981-2000.data.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/hadisst_ice.data.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/ice.climo.1981-2000.data.nc</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="c192_data">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/lm3/19810101.static_veg.remapped_to_C192_GIS_025.v20140328.tar</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/lm3/c192_GIS_025_hydrography_v20140328.tar</dataSource>
      </dataFile>
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/ic/awg_C192L48_LM3_GIS_025_grid_19810101.remapped.v20140328.tar</dataSource>
      </dataFile>
      <dataFile label="gridSpec" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/grid/c192_GIS_025_grid_v20140327.tar</dataSource>
      </dataFile>
    </input>
  </experiment>


  <experiment name="c192_atmos_domain_decomp">
    <input>
      <csh><![CDATA[
# Possible domain decomposition for c192 atmosphere only experiments (numbers from Rusty Benson).
set domains_stack_size = "3097152"
set do_ocean = "false"
if ( "$npes" == "864" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,6"; set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"
else if ( "$npes" == "1152" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "8,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,24";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
else if ( "$npes" == "2304" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set physics_window = "24,2"
  set fv_layout    =   "8,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,24";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
else if ( "$npes" == "3456" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set physics_window = "32,1"
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,6"; set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"
else if ( "$npes" == "4608" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set physics_window = "16,3"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in this xml."
  if ( $echoOn ) set echo
  exit 1
endif

# runCommand:
  alias runCommand "aprun -d $atmos_nthreads -n $atmos_npes ./$executable:t"
      ]]></csh>

      <csh type="always"><![CDATA[
cd INPUT

# adjustment of dry mass first time only
set adjust_dry_mass = `/ncrc/home1/Larry.Horowitz/bin/adjust_dry_mass.csh`

# create dummy MOM6 parameter file
touch MOM_input
      ]]></csh>
    </input>
  </experiment>

  <experiment name="c192_coupled_domain_decomp">
    <input>
      <csh><![CDATA[
#Niki: ocean_layout and ocean_io_layout could only be specified in MOM_override and setting them here does not do anything
# Coupled configurations
set domains_stack_size = "3097152"
if ( "$npes" == "1152" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "24,12"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "288"

else if ( "$npes" == "1728" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "0,0"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "576"

else if ( "$npes" == "3456" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set physics_window = "16,3"
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "0,0"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes = "1152"

else if ( "$npes" == "3210" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set physics_window = "16,3"
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.246.32x36"
  set ocean_npes = "906"

else if ( "$npes" == "6912" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set physics_window = "16,3"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2304"

else if ( "$npes" == "7040" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set physics_window = "16,3"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set do_ocean = "true"
  set ocean_npes   = "2432"

else if ( "$npes" == "8576" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set physics_window = "12,3"
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set do_ocean = "true"
  set ocean_npes   = "2432"

else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in this xml."
  if ( $echoOn ) set echo
  exit 1
endif

cat > $work/INPUT/MOM_layout << LAYOUT_EOF
LAYOUT = $ocn_layout
#override IO_LAYOUT = $ocn_io_layout
MASKTABLE = $ocn_mask_table
LAYOUT_EOF

# runCommand:
  alias runCommand "aprun -d $atmos_nthreads -n $atmos_npes ./$executable:t : -n $ocean_npes -d 1 ./$executable:t"
      ]]></csh>

      <csh type="always"><![CDATA[
cd INPUT

# adjustment of dry mass first time only
set adjust_dry_mass = `/ncrc/home1/Larry.Horowitz/bin/adjust_dry_mass.csh`

      ]]></csh>
    </input>
  </experiment>


<!--================================-->
<!--= TEMPLATES FOR POSTPROCESSING =-->
<!--================================-->

  <experiment name="c192_amip_postprocess">
    <postProcess>

      <component type="atmos" zInterp="era40" start="$(ANA_AMIP_START)" source="atmos_month" cubicToLatLon="360,576">
        <timeSeries freq="3hr" source="atmos_8xdaily" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/atmos8xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
<!-- MDBI, this switch must be on to trigger "fredb" automatically -->
          <analysis switch="$(MDBIswitch)" cumulative="no" script="$FRE_CURATOR_HOME/share/bin/database_ingestor.csh"/>
<!-- /MDBI -->
        </timeSeries>
        <timeSeries freq="6hr" source="atmos_4xdaily" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/atmos4xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="atmos_daily" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/atmosDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/atmosMonthTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/atmosMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
        <timeAverage source="annual" interval="$(PP_AMIP_CHUNK)" calcInterval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="annual" interval="$(ANA_AMIP_LEN)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/atmosAnnualAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_level" start="$(ANA_AMIP_START)" source="atmos_month" cubicToLatLon="360,576">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)"/>
        <timeSeries freq="annual" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/atmosLevelAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/atmosLevelMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_month_aer" start="$(ANA_AMIP_START)" source="atmos_month_aer" cubicToLatLon="360,576" interpMethod="conserve_order1">
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/atmosMonthAerAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_diurnal" start="$(ANA_AMIP_START)" source="atmos_diurnal" cubicToLatLon="360,576">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
      </component>

      <component type="atmos_scalar" start="$(ANA_AMIP_START)" source="atmos_scalar">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)"/>
      </component>

<!-- FULL CHEMISTRY -->
      <component type="tracer_level" start="$(ANA_AMIP_START)" source="atmos_tracer" cubicToLatLon="360,576" interpMethod="conserve_order1">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)"/>
        <timeSeries freq="annual" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/tracerAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/tracerMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

<!-- LAND -->
      <component type="land" start="$(ANA_AMIP_START)" source="land_month" cubicToLatLon="360,576" interpMethod="conserve_order1">
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_AMIP_CHUNK)"/>
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/landMonthTS/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/landMonthAve/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeAverage>
      </component>

      <component type="land_cubic" start="$(ANA_AMIP_START)" source="land_month" cubicToLatLon="none">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)" >
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/landMonthTSNative/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_amip.xml" xpointer="xpointer(*/landDailyTSNative/*)">
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
      </component>

    </postProcess>
  </experiment>


  <experiment name="c192_cmip_postprocess">
    <postProcess>

      <component type="atmos" zInterp="era40" start="$(ANA_CMIP_START)" source="atmos_month" cubicToLatLon="360,576">
        <timeSeries freq="3hr" source="atmos_8xdaily" chunkLength="$(PP_CMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/atmos8xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
<!-- MDBI, this switch must be on to trigger "fredb" automatically -->
          <analysis switch="$(MDBIswitch)" cumulative="no" script="$FRE_CURATOR_HOME/share/bin/database_ingestor.csh"/>
<!-- /MDBI -->
        </timeSeries>
        <timeSeries freq="6hr" source="atmos_4xdaily" chunkLength="$(PP_CMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/atmos4xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="atmos_daily" chunkLength="$(PP_CMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/atmosDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="monthly" chunkLength="$(PP_CMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/atmosMonthTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_CMIP_LEN)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/atmosMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
        <timeAverage source="annual" interval="$(PP_CMIP_CHUNK)" calcInterval="$(PP_CMIP_CHUNK)"/>
        <timeAverage source="annual" interval="$(ANA_CMIP_LEN)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/atmosAnnualAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_level" start="$(ANA_CMIP_START)" source="atmos_month" cubicToLatLon="360,576">
        <timeSeries freq="monthly" chunkLength="$(PP_CMIP_CHUNK)"/>
        <timeSeries freq="annual" chunkLength="$(PP_CMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/atmosLevelAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_CMIP_LEN)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/atmosLevelMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_month_aer" start="$(ANA_CMIP_START)" source="atmos_month_aer" cubicToLatLon="360,576" interpMethod="conserve_order1">
        <timeAverage source="monthly" interval="$(PP_CMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_CMIP_LEN)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/atmosMonthAerAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_diurnal" start="$(ANA_CMIP_START)" source="atmos_diurnal" cubicToLatLon="360,576">
        <timeSeries freq="monthly" chunkLength="$(PP_CMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(PP_CMIP_CHUNK)"/>
      </component>

      <component type="atmos_scalar" start="$(ANA_CMIP_START)" source="atmos_scalar">
        <timeSeries freq="monthly" chunkLength="$(PP_CMIP_CHUNK)"/>
      </component>

<!-- FULL CHEMISTRY -->
      <component type="tracer_level" start="$(ANA_CMIP_START)" source="atmos_tracer" cubicToLatLon="360,576" interpMethod="conserve_order1">
        <timeSeries freq="monthly" chunkLength="$(PP_CMIP_CHUNK)"/>
        <timeSeries freq="annual" chunkLength="$(PP_CMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/tracerAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_CMIP_LEN)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/tracerMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

<!-- LAND -->
      <component type="land" start="$(ANA_CMIP_START)" source="land_month" cubicToLatLon="360,576" interpMethod="conserve_order1">
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_CMIP_CHUNK)"/>
        <timeSeries freq="monthly" chunkLength="$(PP_CMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/landMonthTS/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_CMIP_LEN)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/landMonthAve/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeAverage>
      </component>

      <component type="land_cubic" start="$(ANA_CMIP_START)" source="land_month" cubicToLatLon="none">
        <timeSeries freq="monthly" chunkLength="$(PP_CMIP_CHUNK)" >
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/landMonthTSNative/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_CMIP_CHUNK)">
          <xi:include href="/home/fms/local/opt/fre-analysis/test/niz/xml/analysis_cmip.xml" xpointer="xpointer(*/landDailyTSNative/*)">
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
      </component>

    </postProcess>
  </experiment>

 
<!--====================-->
<!--= AMIP EXPERIMENTS =-->
<!--====================-->

  <experiment name="c192L48_am4a1" inherit="cm4p1_compile">

<!-- MDBI -->
    <description
communityProject="$(ProjectID)" 
communityModel="am4a1" 
communityModelID="am4a1"
communityExperimentName="$(name)" 
communityExperimentID="$(name)" >
<!-- /MDBI -->

AM4 prototype configuration "am4a1" from MDT Atmosphere Working Group.

c192 horizontal grid with approximately 50km resolution and 48 vertical levels.
Convection based on "double-plume 3" from Ming Zhao.
Configuration derived from "c192L48_awgp2d3".

For more information about AWG configurations, refer to
http://cobweb.gfdl.noaa.gov/~cjg/awg

    </description>

<!-- MDBI -->
    <realization r="1" i="1" p="1"/>
    <communityComment>
Experiment name = $(name)
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_AMIP_START)"
      endTime="$(EXP_AMIP_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

    <input>
      <!-- Namelist -->
      <namelist file="$(AWG_INPUT_HOME)/nml/ocean_v20140325.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_common_v20140325.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_physics_dpc3_v20130324.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_c192_v20140324.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_amip_v20140324.nml"/>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1980,1,1,0,0,0,
        calendar = 'julian'
        dt_atmos = 1200,
        dt_cpld  = 7200,
        use_lag_fluxes = .true.
        concurrent = .false.
        do_ocean = .false.
        ocean_npes=0
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <!-- Input datasets -->
      <xi:include xpointer="xpointer(//experiment[@name='common_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='amip_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192_atmos_domain_decomp']/input/node())"/>
    </input>

    <runtime>
      <production simTime="$(EXP_AMIP_LEN)" units="years" npes="4608" runTime="16:00:00">
        <segment simTime="12" units="months" runTime="5:20:00"/>
      </production>
      <regression name="basic">
        <run days="8" npes="864" runTimePerJob="01:00:00"/>
      </regression>
      <regression name="restarts">
        <run days="4 4" npes="1152" runTimePerJob="01:00:00"/>
      </regression>
      <regression name="timing">
        <run months="1"   npes="864"  runTimePerJob="02:30:00"/> 
        <run months="1"   npes="1152" runTimePerJob="02:00:00"/> 
        <run months="1"   npes="2304" runTimePerJob="01:30:00"/>
        <run months="1"   npes="3456" runTimePerJob="01:00:00"/>
        <run months="1"   npes="4608" runTimePerJob="01:00:00"/>
        <run months="1"   npes="6912" runTimePerJob="01:00:00"/>
      </regression>
    </runtime>

    <postProcess>
      <xi:include xpointer="xpointer(//experiment[@name='c192_amip_postprocess']/postProcess/node())"/>
    </postProcess>

  </experiment>


<!--=======================-->
<!--= COUPLED EXPERIMENTS =-->
<!--=======================-->
<!-- Implemented by Niki -->
  <experiment name="OM4_data">
    <input>
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/MOM_input</dataSource>
       <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/layer_coord.nc</dataSource>
       <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/tidal_amplitude.v20140328.nc</dataSource>
       <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/MOM_channels_global_025</dataSource>
       <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/vgrid_cm4.nc</dataSource>
       <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/seawifs_1998-2006_smoothed_2x_v2.nc</dataSource>
       <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/WOA05_pottemp_salt.nc</dataSource>
       <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/mask_table.246.32x36</dataSource>
       <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/mask_table.548.32x72</dataSource>
       <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/mask_table.808.45x72</dataSource>
    </dataFile>      

      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/diag_table.MOM6</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/examples/ocean_SIS/MOM6z_SIS_025/diag_table.MOM6</dataSource>
      </dataFile>

     <namelist name="MOM_input_nml" >
         output_directory = './',
         input_filename = '$restart_flag'
         restart_input_dir = 'INPUT/',
         restart_output_dir = 'RESTART/',
         parameter_filename = 'INPUT/MOM_input','INPUT/MOM_layout','INPUT/MOM_override'
     </namelist>
      <namelist name="ice_albedo_nml">
            t_range = 10.
      </namelist>
      <namelist name="monin_obukhov_nml">
	stable_option = 2,
        rich_crit = 1.0,
        zeta_trans = 0.5
      </namelist>
      <csh type="always"><![CDATA[
if ( $ireload == 1 ) then
 if ( $irun == 1 ) then
  set restart_flag = 'n'
 else
  set restart_flag = 'r'
 endif
else
  set restart_flag = 'r'
endif


ln -s $work/INPUT/topog.nc $work/INPUT/ocean_topog.nc

touch $work/INPUT/MOM_override

      ]]></csh>
 
     </input>

  </experiment>

  <experiment name="SIS_data">
    <input>

     <dataFile label="input" target="INPUT/ice_model.res.nc" chksum="" size="" timestamp="">
       <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/ice_model.res.v20140507.nc</dataSource>
     </dataFile>      
     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/diag_table.SIS</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/examples/ocean_SIS/MOM6z_SIS_025/diag_table.SIS</dataSource>
     </dataFile>
      
     <namelist name="ice_model_nml">
           layout = $ice_layout
           io_layout = $ice_io_layout
           nsteps_dyn=144
           nsteps_adv=2
           num_part = 6
           wd_turn = 0.0
           spec_ice=.false.
           ice_bulk_salin = 0.0
           alb_sno = 0.85                    ! keep CM2 setting
           alb_ice = 0.65                    ! keep CM2 setting
           t_range_melt = 1.0                ! NOTE: CM2 uses 1.0
           heat_rough_ice = 5.0e-4
           cm2_bugs = .false.
           do_icebergs = .true.
           add_diurnal_sw = .false.
           do_ice_limit=.false.
           max_ice_limit=4.0
           channel_viscosity=0.e5
           h_lo_lim = 1.e-10
      </namelist>
      <namelist name="icebergs_nml">
        really_debug=.FALSE.
        debug=.FALSE.
        verbose=.FALSE.
        verbose_hrs=7200
        use_operator_splitting=.TRUE.
        bergy_bit_erosion_fraction=0.0
        sicn_shift=0.1
        parallel_reprod=.TRUE.
        traj_sample_hrs=0
        add_weight_to_ocean=.false.
      </namelist>

      <namelist name="ocean_albedo_nml">
            ocean_albedo_option = 5
      </namelist>
      <namelist name="ocean_rough_nml">
            rough_scheme = 'beljaars'
      </namelist>
     </input>
  </experiment>


 <experiment name="CM4_c192L48_am4a1_2000" inherit="cm4p1_compile">

<!-- MDBI -->
    <description
communityProject="$(ProjectID)" 
communityModel="CM4_AM4a1_SIS  $(MOM6_GIT_TAG)" 
communityModelID="CM4_AM4a1_SIS"
communityExperimentName="$(name)" 
communityExperimentID="$(name)" >
<!-- /MDBI -->

    </description>
<!-- MDBI -->
    <realization r="1" i="1" p="1"/>
    <communityComment>
      Experiment name = $(name)
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_CMIP_START)"
      endTime="$(EXP_CMIP_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

    <input>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1,1,1,0,0,0,
        calendar = 'NOLEAP'
        dt_atmos = 1200,
        dt_cpld  = 3600,
        use_lag_fluxes = .true.
        concurrent = .true.
        do_ocean = .true.
        ocean_npes = $ocean_npes
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <namelist name="flux_exchange_nml">
            debug_stocks = .FALSE.
            divert_stocks_report = .TRUE.
            do_area_weighted_flux = .FALSE.
      </namelist>
      <namelist name="fms_io_nml">
            fms_netcdf_restart=.true.
            threading_read='multi'
            threading_write='single'
            fileset_write='single'
            max_files_r = 200
            max_files_w = 200
      </namelist>
      <namelist name="fms_nml">
            clock_grain='ROUTINE'
            clock_flags='NONE'
            domains_stack_size = 5000000
            stack_size =0
      </namelist>
      <namelist name="xgrid_nml">
        make_exchange_reproduce = .true.
        interp_method = 'second_order'
      </namelist>

      <csh type="always"><![CDATA[
cat > $work/INPUT/MOM_override << OVERRIDE_EOF
#override RESTORE_SALINITY = False
#override ADJUST_NET_FRESH_WATER_TO_ZERO = False
OVERRIDE_EOF
      ]]></csh>

      <!--AWG Input datasets -->
      <!-- Namelist -->
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_common_v20140325.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_physics_dpc3_v20130324.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_c192_v20140324.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_2000climo_v20140324.nml"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192_coupled_domain_decomp']/input/node())"/>

      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data']/input/node())"/>
    </input>

    <runtime>
      <production simTime="$(EXP_CMIP_LEN)" units="years" npes="7040" runTime="12:00:00">
        <segment simTime="12" units="months" runTime="12:00:00"/>
      </production>
      <regression name="basic">
        <run days="10" npes="1728" runTimePerJob="01:20:00"/><!--npes= 1728  main_loop= 1788.911409  ATM= 1633.894547  OCN= 1701.778858  SYPD= 1.32322-->
      </regression>

      <regression name="rts"> <!--fits on t1-->
            <run days="10" npes="3456" runTimePerJob="00:30:00"/><!--npes= 3456  main_loop= 961.055729  ATM= 861.276609  OCN= 930.596231  SYPD= 2.46304-->        
        <run days="10" npes="7040" runTimePerJob="00:10:00"/><!--npes= 7040  main_loop= 18846.426343  ATM= 18575.064638  OCN= 15403.657272  SYPD= 4.52162-->

      </regression>

      <regression name="bigrts">
        <run days="10" npes="8576" runTimePerJob="00:30:00"/><!---->
      </regression>

    </runtime>

    <postProcess>
      <xi:include xpointer="xpointer(//experiment[@name='c192_cmip_postprocess']/postProcess/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='OM4_postprocess']/postProcess/node())"/>
    </postProcess>

  </experiment>


 <experiment name="OM4_SIS_baseline" inherit="cm4p1_compile">

<!-- MDBI -->
    <description
communityProject="$(ProjectID)" 
communityModel="OM4_SIS  $(MOM6_GIT_TAG)" 
communityModelID="OM4_SIS"
communityExperimentName="$(name)" 
communityExperimentID="$(name)" >
<!-- /MDBI -->

    </description>
<!-- MDBI -->
    <realization r="1" i="1" p="1"/>
    <communityComment>
      Experiment name = $(name)
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_CMIP_START)"
      endTime="$(EXP_CMIP_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

    <input>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1900,1,1,0,0,0,
        calendar = 'NOLEAP'
        dt_atmos = 3600,
        dt_cpld  = 3600,
        use_lag_fluxes = .false.
        concurrent = .false.
	do_atmos = .false.
	do_land  = .false.
        do_ocean = .true.
        ocean_npes = $ocean_npes
        atmos_npes = 0
      </namelist>
      <namelist name="flux_exchange_nml">
            debug_stocks = .FALSE.
            divert_stocks_report = .TRUE.
            do_area_weighted_flux = .FALSE.
      </namelist>
      <namelist name="fms_io_nml">
            fms_netcdf_restart=.true.
            threading_read='multi'
            threading_write='single'
            fileset_write='single'
            max_files_r = 200
            max_files_w = 200
      </namelist>
      <namelist name="fms_nml">
            clock_grain='ROUTINE'
            clock_flags='NONE'
            domains_stack_size = 5000000
            stack_size =0
      </namelist>
      <namelist name="xgrid_nml">
        make_exchange_reproduce = .true.
        interp_method = 'second_order'
      </namelist>

     <namelist name="ice_model_nml" >
           layout = $ice_layout
           io_layout = $ice_io_layout
           nsteps_dyn=144
           nsteps_adv=2
           num_part = 6
           wd_turn = 0.0
           spec_ice=.false.
           ice_bulk_salin = 0.005
           alb_sno = 0.85                    ! keep CM2 setting
           alb_ice = 0.65                    ! keep CM2 setting
           t_range_melt = 1.0                ! NOTE: CM2 uses 1.0
           heat_rough_ice = 5.0e-4
           cm2_bugs = .false.
           do_icebergs = .false.
           atmos_winds=.true.
           add_diurnal_sw = .true.
           do_ice_limit=.false.
           max_ice_limit=4.0
           channel_viscosity=5.e5
           chan_cfl_limit=0.001
           h_lo_lim = 1.e-10
    </namelist>

      <namelist name="monin_obukhov_nml">
	neutral = .true.
      </namelist>
      <namelist name="ocean_albedo_nml">
            ocean_albedo_option = 2
      </namelist>
      <namelist name="surface_flux_nml">
            ncar_ocean_flux = .true.
	    raoult_sat_vap = .true.
      </namelist>
      <namelist name="topography_nml">
            topog_file = 'INPUT/navy_topography.data.nc'
      </namelist>

      
<!--
      <namelist name="static_veg_nml">
        use_static_veg = .false.
      </namelist>
      <namelist name="river_nml">
        do_rivers = .false.
      </namelist>
      <namelist name="topo_rough_nml">
       use_topo_rough    = .false.
      </namelist>
      <namelist name="">
      </namelist>

      <namelist name="fv_core_nml">
        layout    = $fv_layout
        io_layout = $fv_io_layout
	warm_start = .false.
        npx      = 193,
        npy      = 193,
        ntiles   = 6,
        npz      = 48,
        k_split  = 4,
        n_split  = 5,
        a2b_ord  = 4,
        hord_dp = 13,
        adjust_dry_mass = $adjust_dry_mass,
        consv_te = 0.7,
        fill = .true.
        print_freq = 0,
        grid_type = 0,
        nord = 1,
        dddmp = 0.0,
        d2_bg = 0.0,
        d4_bg = 0.16,
        tau = 0.
        z_tracer=.false.
 	
      </namelist>
-->
      <!--AWG Input datasets -->
      <!-- Namelist -->
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_common_v20140325.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_physics_dpc3_v20130324.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_c192_v20140324.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_2000climo_v20140324.nml"/>

      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data']/input/node())"/>

      <diagTable>
$name
$baseDate

      </diagTable>
      <!--   The following block is purely needed for the initialization to work  -->
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/lm3/19810101.static_veg.remapped_to_C192_GIS_025.v20140328.tar</dataSource>
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/lm3/c192_GIS_025_hydrography_v20140328.tar</dataSource>
      </dataFile>
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/ic/awg_C192L48_LM3_GIS_025_grid_19810101.remapped.v20140328.tar</dataSource>
      </dataFile>

      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/common/sea_esf_aug2013.cpio</dataSource>
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/lm3/lm3_data_20130815.tar</dataSource>
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/aerosol_inputs.dec2009.cpio</dataSource>
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/RCP/cmip5_rcp45.cpio</dataSource>
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/tropchem_oct2011.cpio</dataSource>
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/megan2.1_input.cpio</dataSource>
       <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/historical/emissions.1x1.1859_2020.tar</dataSource>
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/aerosol/gas_conc_3D48L_am3p9.nc</dataSource>
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/emissions/so2_0.25_volcanoes.nc</dataSource>
      </dataFile>
      
      <dataFile label="input" target="INPUT/anthro_so2.1859_2010.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/emissions/emissions.simple.so2.1x1.1859_2020.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/emis_fuel_aircraft.1859_2010.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/emissions/emissions.aircraft.aero.1x1.1859_2020.nc</dataSource>
      </dataFile>
      <dataFile label="fieldTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/field_table/field_table_am4p1_v20140324</dataSource>
      </dataFile>
      <!--  The above block is purely needed for the initialization to work    -->
											  

      <!-- Use the coupled model grid -->
      <dataFile label="gridSpec" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/grid/c192_GIS_025_grid_v20140327.tar</dataSource>
      </dataFile>

      <!--CORE forcing and salt restore data and data_table-->
      <dataFile label="dataTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/data_table</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/ncar_precip.clim.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/ncar_rad.clim.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/q_10_mod.clim.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/runoff.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/salt_restore_v3.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/slp.clim.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/t_10_mod.clim.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/u_10_mod.clim.nc</dataSource>
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/MOM6z_SIS_025/INPUT/v_10_mod.clim.nc</dataSource>
      </dataFile>

      <csh><![CDATA[
# Possible domain decomposition.
#The following layouts are for OM4 regression testing and are not suitable for CM4 runs
#--------------------------------------------------------------------------------------
if ( "$npes" == "288" ) then
  set serial = "true"
  set atmos_npes = "288"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "2,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "2,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "24,12"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "24,12"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes = "288"
else if ( "$npes" == "576" ) then
  set serial = "true"
  set atmos_npes = "576"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "4,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "4,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "24,24"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "24,24"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes = "576"

else if ( "$npes" == "1152" ) then
  set serial = "true"
  set atmos_npes = "1152"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "8,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "36,32"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "36,32"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes = "1152"

#--------------------------------------------------------------------------------------

else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in xml."
  if ( $echoOn ) set echo
  exit 1
endif

cat > $work/INPUT/MOM_layout << LAYOUT_EOF
LAYOUT = $ocn_layout
#override IO_LAYOUT = $ocn_io_layout
MASKTABLE = $ocn_mask_table
LAYOUT_EOF

\rm -f land.res.tile* soil.res.tile* lake.res.tile* vegn* snow.res.tile* river.res.tile* cana.res.tile* glac.res.tile*

# runCommand:
if ( $do_ocean == "true" ) then
 if( $serial  == "true" ) then
  alias runCommand "aprun -d 1  -n $ocean_npes ./$executable:t"
 else
  alias runCommand "aprun -d $atmos_nthreads -n $atmos_npes ./$executable:t : -n $ocean_npes -d 1 ./$executable:t"
 endif  	
else
  alias runCommand "aprun -d $atmos_nthreads -n $atmos_npes ./$executable:t"
endif
      ]]></csh>

    </input>

    <runtime>
       <regression name="basic">
         <run days="10"   npes="1152"  runTimePerJob="00:30:00"/>
       </regression>
       <regression name="rts">
         <run days="5 5"  npes="1152"  runTimePerJob="00:30:00"/>
         <run days="10"   npes="288"  runTimePerJob="00:30:00"/>
         <run days="10"   npes="576"  runTimePerJob="00:30:00"/>
       </regression>

      <production simTime="$(PROD_SIMTIME_OM4)" units="years" npes="2996" runTime="$(PROD_RUNTIME_OM4)">
           <segment simTime="12" units="months" runTime="$(PROD_SEGTIME_OM4)"/>
       </production>

      <reference restart="$(REFERENCE)/1x0m10d_2996pe/restart/19000111.tar"/>
    </runtime>

    <postProcess>
      <xi:include xpointer="xpointer(//experiment[@name='OM4_postprocess']/postProcess/node())"/>
    </postProcess>

  </experiment>


  <!-- OCEAN  and ICE post-processing-->
  <experiment name="OM4_postprocess">
    <postProcess>
        <csh><![CDATA[
	 #Take care of iceberg restarts and trajectories
         cd $work/RESTART
         ncrcat icebergs.res.nc.* icebergs.res.nc
         rm -f icebergs.res.nc.*
         cd $work
         ncrcat iceberg_trajectories.nc.* iceberg_trajectories.nc
         rm -f iceberg_trajectories.nc.* 
         #Save the last line of timestats without the first (step number) column as a signature of MOM6 answers
         tail -1 timestats | cut -c8- > RESTART/$enddate.timestats.res
         #Save the whole timestats under ascii/
         mv timestats $enddate.timestats
         mv timestats.nc $enddate.timestats.nc

         #Make a directory to trick FRE to pick up and archive in ascii
         mkdir extra.results

         mv *velocity_truncations CPU_stats MOM_parameter_doc* extra.results/

         ]]></csh>
      <!--REFINE DIAG SCRIPT to untar the files under history/ -->
      <refineDiag script="$(NB_ROOT)/mom6/tools/analysis/MOM6_refineDiag.csh $(NB_ROOT)/mom6/tools/analysis/refineDiag_data_stager.csh"/>

      <component type="ocean_monthly"   start="$(ANA_CLIMO_START)" source="ocean_month">
        <timeSeries freq="monthly" chunkLength="$(PP_OCEAN_CHUNK)" source="ocean_month">
          <analysis switch="$(ANALYSIS_SWITCH)" startYear="$(ANA_CLIMO_START)" script="$(NB_ROOT)/mom6/examples/ocean_SIS/MOM6z_SIS_025/ocn_monthly.frepp"/>
        </timeSeries>        
      </component>
      
      <component type="ocean_annual"   start="$(ANA_CLIMO_START)" source="ocean_annual">
        <timeSeries freq="annual"  chunkLength="$(PP_OCEAN_CHUNK)" source="ocean_annual">
          <analysis switch="$(ANALYSIS_SWITCH)" startYear="$(ANA_CLIMO_START)" script="$(NB_ROOT)/mom6/examples/ocean_SIS/MOM6z_SIS_025/ocn_annual.frepp"/>
        </timeSeries>
        <timeAverage source="annual"  interval="$(PP_OCEAN_CHUNK)"/>
      </component>
      
      <component type="ice"  start="$(ANA_CLIMO_START)"  source="ice_month">
        <timeSeries freq="monthly" chunkLength="$(PP_OCEAN_CHUNK)"  source="ice_month">
	   <analysis switch="$(ANALYSIS_SWITCH)" startYear="$(ANA_CLIMO_START)" script="$(NB_ROOT)/mom6/tools/analysis/Krasting-SeaIce.csh"/>
	</timeSeries>   
        <timeAverage source="annual"  interval="$(PP_OCEAN_CHUNK)"/>
      </component>
      
      <!--The following mdbi_logger component is a trial to make the db ingestor run when the yearly data arrives
          in order to update the "Monitoring" section of the DB.
          The intention was not to do anything besides that update. We do not really want an annual timeseries.
          But unfortunately frepp still tries to create a timeseries. -->
      <component type="mdbi_logger"   start="$(ANA_CLIMO_START)" source="ocean_annual">
        <timeSeries freq="annual"  chunkLength="1yr" source="ocean_annual">
         <variables>salt_flux</variables>
         <analysis switch="on" cumulative="no" script="$FRE_CURATOR_HOME/share/bin/database_ingestor.csh"/>
        </timeSeries>
      </component>

    </postProcess>
  </experiment> 
</experimentSuite>
